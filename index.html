<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Nerdle - Das Worträtsel für c’t-Fans</title>
    <link rel="stylesheet" href="nerdle-styles.css">
    <link rel="stylesheet" href="https://pyscript.net/alpha/pyscript.css" />
    <script defer src="https://pyscript.net/alpha/pyscript.js"></script>
</head>
<body>
    <div class="headingcontainer">
        <h1>Nerdle</h1>
        <h3>Das Worträtsel für c’t-Fans</h3>
    </div>
    <div class="infoblock">
        <div id="error" style="display: none"></div>
        <div id="info" style="display: none"></div>
    </div>
    <div class="board">
        <div class="row">
            <div class="tile" id="t00">&nbsp;</div>
            <div class="tile" id="t01">&nbsp;</div>
            <div class="tile" id="t02">&nbsp;</div>
            <div class="tile" id="t03">&nbsp;</div>
            <div class="tile" id="t04">&nbsp;</div>
        </div>
        <div class="row">
            <div class="tile" id="t10">&nbsp;</div>
            <div class="tile" id="t11">&nbsp;</div>
            <div class="tile" id="t12">&nbsp;</div>
            <div class="tile" id="t13">&nbsp;</div>
            <div class="tile" id="t14">&nbsp;</div>
        </div>
        <div class="row">
            <div class="tile" id="t20">&nbsp;</div>
            <div class="tile" id="t21">&nbsp;</div>
            <div class="tile" id="t22">&nbsp;</div>
            <div class="tile" id="t23">&nbsp;</div>
            <div class="tile" id="t24">&nbsp;</div>
        </div>
        <div class="row">
            <div class="tile" id="t30">&nbsp;</div>
            <div class="tile" id="t31">&nbsp;</div>
            <div class="tile" id="t32">&nbsp;</div>
            <div class="tile" id="t33">&nbsp;</div>
            <div class="tile" id="t34">&nbsp;</div>
        </div>
        <div class="row">
            <div class="tile" id="t40">&nbsp;</div>
            <div class="tile" id="t41">&nbsp;</div>
            <div class="tile" id="t42">&nbsp;</div>
            <div class="tile" id="t43">&nbsp;</div>
            <div class="tile" id="t44">&nbsp;</div>
        </div>
        <div class="row">
            <div class="tile" id="t50">&nbsp;</div>
            <div class="tile" id="t51">&nbsp;</div>
            <div class="tile" id="t52">&nbsp;</div>
            <div class="tile" id="t53">&nbsp;</div>
            <div class="tile" id="t54">&nbsp;</div>
        </div>
    </div>
    <div id="keyboard">
        <div class="row">
            <div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>0</div><div><svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24" class="game-icon"><path
                    fill="var(--color-tone-1)" d="M22 3H7c-.69 0-1.23.35-1.59.88L0 12l5.41 8.11c.36.53.9.89 1.59.89h15c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H7.07L2.4 12l4.66-7H22v14zm-11.59-2L14 13.41 17.59 17 19 15.59 15.41 12 19 8.41 17.59 7 14 10.59 10.41 7 9 8.41 12.59 12 9 15.59z"></path></svg></div>
        </div>
        <div class="row">
            <div>Q</div><div>W</div><div>E</div><div>R</div><div>T</div><div>Z</div><div>U</div><div>I</div><div>O</div><div>P</div><div>Ü</div>
        </div>
        <div class="row">
            <div>A</div><div>S</div><div>D</div><div>F</div><div>G</div><div>H</div><div>J</div><div>K</div><div>L</div><div>Ö</div><div>Ä</div>
        </div>
        <div class="row">
            <div>Y</div><div>X</div><div>C</div><div>V</div><div>B</div><div>N</div><div>M</div><div>/</div><div>ß</div><div>;</div><div style="font-size: 70%; line-height: 200%">ENTER</div>
        </div>
    </div>
<py-env>
</py-env>
<py-script>
from js import document, console
from pyodide import create_proxy
import random

wordlist = ['ASCII',
            'ADMIN',
            'ARIAL',
            'AUDIO',
            'AZTEC',
            'BASIC',
            'BYTES',
            'COBOL',
            'CODEC',
            'DENIC',
            'DSGVO',
            'NOSQL',
            'EMACS',
            'ETHER',
            'FORTH',
            'FRAME',
            'GATES',
            'GENOM',
            'GEOIP',
            'HTTPS',
            'INDEX',
            'INTEL',
            'KNUTH',
            'LATEX',
            'LAYER',
            'LINUX',
            'MODUL',
            'NOTCH',
            'NUDOL',
            'OCAML',
            'ORBIT',
            'PAKET',
            'PIXEL',
            'RASPI',
            'RAUTE',
            'REGEX',
            'SCALA',
            'SCAPY',
            'SHELL',
            'SINUS',
            'SKILL',
            'SLASH',
            'SWIFT',
            'TIOBE',
            'THEME',
            'TOKEN',
            'VIDEO',
            'VIRUS',
            'MACOS']
word = random.choice(wordlist).upper()

console.log("Wort: ", " ".join(list(word.upper())))

guess = ""
guess_no = 0
key_objects = {}

def display_guess():
    for i in range(5):
        document.getElementById("t{:d}{:d}".format(guess_no, i)).textContent = "&nbsp;"
    for pos, char in enumerate(list(guess)):
        document.getElementById("t{:d}{:d}".format(guess_no, pos)).textContent = char

def evaluate_guess():
    global word, guess
    for pos, char in enumerate(list(guess)):
        console.log("evaluate: ", guess, word, pos, char, word[pos])
        if char == word[pos]:
            document.getElementById("t{:d}{:d}".format(guess_no, pos)).classList.add("nailedit")
            key_objects[char].classList.add("nailedit")
        elif char in word:
            document.getElementById("t{:d}{:d}".format(guess_no, pos)).classList.add("somewhere")
            key_objects[char].classList.add("somewhere")
        else:
            document.getElementById("t{:d}{:d}".format(guess_no, pos)).classList.add("nope")
            key_objects[char].classList.add("nope")

def check_enter():
    global guess, guess_no, wordlist
    if len(guess) != 5:
        return
    if guess not in wordlist:
        pyscript.write("error", "Das geratene Wort ist nicht nerdig genug!")
        pyscript.write("info", "„{}“ steht nicht in der Wortliste.".format(guess))
        document.getElementById("error").style = "display: visible;"
        document.getElementById("info").style = "display: visible;"
        return
    evaluate_guess()
    guess = ""
    guess_no += 1

def key_clicked(e):
    global guess
    if len(guess) >= 5 and len(e.target.textContent) == 1:
        guess = guess[:5]
        display_guess()
        return
    match len(e.target.textContent):
        case 0:
            guess = guess[:-1]
        case 1:
            guess += e.target.textContent
        case _:
            check_enter()
    display_guess()

js_key_clicked = create_proxy(key_clicked)

for row in document.getElementById("keyboard").childNodes:
    for key in row.childNodes:
        key.addEventListener("click", js_key_clicked)
        if len(key.textContent) == 1:
            key_objects[key.textContent] = key

def key_down(e):
    global guess
    if len(guess) >= 5 and len(e.key) == 1:
        guess = guess[:5]
        display_guess()
        return
    match e.key:
        case "a": guess += "A"
        case "A": guess += "A"
        case "b": guess += "B"
        case "B": guess += "B"
        case "c": guess += "C"
        case "C": guess += "C"
        case "d": guess += "D"
        case "D": guess += "D"
        case "e": guess += "E"
        case "E": guess += "E"
        case "f": guess += "F"
        case "F": guess += "F"
        case "g": guess += "G"
        case "G": guess += "G"
        case "h": guess += "H"
        case "H": guess += "H"
        case "i": guess += "I"
        case "I": guess += "I"
        case "j": guess += "J"
        case "J": guess += "J"
        case "k": guess += "K"
        case "K": guess += "K"
        case "l": guess += "L"
        case "L": guess += "L"
        case "m": guess += "M"
        case "M": guess += "M"
        case "n": guess += "N"
        case "N": guess += "N"
        case "o": guess += "O"
        case "O": guess += "O"
        case "p": guess += "P"
        case "P": guess += "P"
        case "q": guess += "Q"
        case "Q": guess += "Q"
        case "r": guess += "R"
        case "R": guess += "R"
        case "s": guess += "S"
        case "S": guess += "S"
        case "t": guess += "T"
        case "T": guess += "T"
        case "u": guess += "U"
        case "U": guess += "U"
        case "v": guess += "V"
        case "V": guess += "V"
        case "w": guess += "W"
        case "W": guess += "W"
        case "x": guess += "X"
        case "X": guess += "X"
        case "y": guess += "Y"
        case "Y": guess += "Y"
        case "z": guess += "Z"
        case "Z": guess += "Z"
        case "ö": guess += "Ö"
        case "Ö": guess += "Ö"
        case "ä": guess += "Ä"
        case "Ä": guess += "Ä"
        case "ü": guess += "Ü"
        case "Ü": guess += "Ü"
        case "ß": guess += "ß"
        case "ẞ": guess += "ß"
        case "/": guess += "/"
        case ";": guess += "B"
        case "Backspace": guess = guess[:-1]
        case "Enter": check_enter()
    display_guess()

js_key_down = create_proxy(key_down)

document.onkeydown = js_key_down

</py-script>
</body>
</html>